# AGGO - AIæ™ºèƒ½ä»£ç†æ¡†æ¶

AGGOæ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€æ„å»ºçš„æ™ºèƒ½AIä»£ç†æ¡†æ¶ï¼Œé›†æˆäº†å¯¹è¯AIã€çŸ¥è¯†ç®¡ç†ã€è®°å¿†ç³»ç»Ÿå’Œå·¥å…·è°ƒç”¨ç­‰åŠŸèƒ½ï¼ŒåŸºäºCloudWeGo Einoæ¡†æ¶å¼€å‘ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **æ™ºèƒ½å¯¹è¯ä»£ç†**: åŸºäºReactæ¨¡å¼çš„AIä»£ç†ï¼Œæ”¯æŒå·¥å…·è°ƒç”¨å’Œå¤šè½®å¯¹è¯
- **çŸ¥è¯†åº“ç®¡ç†**: åŒé‡å­˜å‚¨æ¶æ„ï¼Œç»“åˆä¼ ç»Ÿæ•°æ®åº“å’Œå‘é‡æ•°æ®åº“å®ç°é«˜æ•ˆçš„è¯­ä¹‰æœç´¢
- **è®°å¿†ç³»ç»Ÿ**: ä¼šè¯çº§è®°å¿†ç®¡ç†ï¼Œæ”¯æŒé•¿æœŸè®°å¿†å­˜å‚¨å’Œæ™ºèƒ½æ‘˜è¦
- **å·¥å…·é›†æˆ**: ä¸°å¯Œçš„å·¥å…·ç”Ÿæ€ï¼ŒåŒ…æ‹¬çŸ¥è¯†æ¨ç†ã€ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œã€æ•°æ®åº“æ“ä½œç­‰
- **å¤šæ•°æ®åº“æ”¯æŒ**: æ”¯æŒSQLiteã€MySQLã€PostgreSQLç­‰å¤šç§æ•°æ®åº“
- **å‘é‡æœç´¢**: æ”¯æŒMilvuså’ŒPostgreSQLå‘é‡æ•°æ®åº“çš„è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢
- **å®æ—¶é€šä¿¡**: æ”¯æŒServer-Sent Events (SSE) æµå¼å“åº”
- **å¯è§‚æµ‹æ€§**: é›†æˆLangfuseè¿›è¡ŒAIåº”ç”¨ç›‘æ§å’Œè¿½è¸ª

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Agentç³»ç»Ÿ     â”‚    â”‚   çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ   â”‚    â”‚   è®°å¿†ç³»ç»Ÿ      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ å¯¹è¯ä»£ç†      â”‚    â”‚ â€¢ æ–‡æ¡£å¤„ç†      â”‚    â”‚ â€¢ ä¼šè¯è®°å¿†      â”‚
â”‚ â€¢ å·¥å…·è°ƒç”¨      â”‚â—„â”€â”€â”€â”¤ â€¢ å‘é‡æœç´¢      â”‚    â”‚ â€¢ é•¿æœŸè®°å¿†      â”‚
â”‚ â€¢ Reactæ¨¡å¼     â”‚    â”‚ â€¢ è¯­ä¹‰æ£€ç´¢      â”‚    â”‚ â€¢ æ™ºèƒ½æ‘˜è¦      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å­˜å‚¨å±‚        â”‚
                    â”‚                 â”‚
                    â”‚ â€¢ GORM (å…ƒæ•°æ®) â”‚
                    â”‚ â€¢ Milvus (å‘é‡) â”‚
                    â”‚ â€¢ Azure OpenAI â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒé‡å­˜å‚¨æ¶æ„

- **å­˜å‚¨å±‚ (Storage)**: ä½¿ç”¨GORMç®¡ç†æ–‡æ¡£å…ƒæ•°æ®ã€å†…å®¹å’Œæ—¶é—´æˆ³
- **å‘é‡å±‚ (VectorDB)**: ä½¿ç”¨Milvuså­˜å‚¨å’Œæœç´¢1024ç»´åº¦çš„å‘é‡æ•°æ®
- **çŸ¥è¯†ç®¡ç†å™¨**: åè°ƒä¸¤ä¸ªå­˜å‚¨å±‚ï¼Œæä¾›ç»Ÿä¸€çš„çŸ¥è¯†åº“ç®¡ç†æ¥å£

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
go mod download
```

### å¤–éƒ¨ä¾èµ–

- **å‘é‡æ•°æ®åº“**: Milvusæˆ–PostgreSQL with pgvectoræ‰©å±•
- **å…³ç³»å‹æ•°æ®åº“**: MySQLã€PostgreSQLæˆ–SQLiteï¼ˆå¯é€‰å…¶ä¸€ï¼‰
- **AIæœåŠ¡**: Azure OpenAIç”¨äºèŠå¤©å’ŒåµŒå…¥å‘é‡ç”Ÿæˆ
- **ç›‘æ§æœåŠ¡**: Langfuseï¼ˆå¯é€‰ï¼Œç”¨äºAIåº”ç”¨ç›‘æ§ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€çŸ¥è¯†åº“ä»£ç†ç¤ºä¾‹

```bash
go run example/knowledge_agent_tool_test/main.go
```

### 2. è®°å¿†ç³»ç»Ÿæµ‹è¯•

```bash
go run example/mem_agent_test/main.go
```

### 3. å­˜å‚¨é›†æˆæµ‹è¯•

```bash
go run example/storage_vectordb_integration/main.go
```

### 4. GORMå­˜å‚¨æµ‹è¯•

```bash
go run example/gorm_storage_test/main.go
```

### 5. SSEæµå¼å“åº”ç¤ºä¾‹

```bash
go run example/sse/main.go
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºçŸ¥è¯†åº“ç®¡ç†å™¨

```go
package main

import (
	"context"
	"log"

	"github.com/CoolBanHub/aggo/knowledge"
	"github.com/CoolBanHub/aggo/knowledge/storage"
	"github.com/CoolBanHub/aggo/knowledge/vectordb"
	"github.com/CoolBanHub/aggo/model"
)

func main() {
	ctx := context.Background()

	// 1. åˆ›å»ºåµŒå…¥æ¨¡å‹
	em, err := model.NewEmbModel()
	if err != nil {
		log.Fatal(err)
	}

	// 2. åˆ›å»ºå‘é‡æ•°æ®åº“ (Milvus)
	vectorDB, err := vectordb.NewMilvusVectorDB(vectordb.MilvusConfig{
		Address:        "127.0.0.1:19530",
		EmbeddingDim:   1024,
		DBName:         "", // ä½¿ç”¨é»˜è®¤æ•°æ®åº“
		CollectionName: "knowledge",
	})
	if err != nil {
		log.Fatal(err)
	}

	// 3. åˆ›å»ºå­˜å‚¨å±‚ (SQLite)
	storage, err := storage.NewSQLiteStorage("knowledge.db")
	if err != nil {
		log.Fatal(err)
	}

	// 4. åˆ›å»ºçŸ¥è¯†åº“ç®¡ç†å™¨
	km, err := knowledge.NewKnowledgeManager(&knowledge.KnowledgeConfig{
		Storage:  storage,
		VectorDB: vectorDB,
		Em:       em,
	})
	if err != nil {
		log.Fatal(err)
	}

	// 5. åŠ è½½æ–‡æ¡£
	docs := []knowledge.Document{
		{
			ID:      "doc1",
			Content: "Goè¯­è¨€æ˜¯ç”±Googleå¼€å‘çš„å¼€æºç¼–ç¨‹è¯­è¨€",
			Metadata: map[string]interface{}{
				"title": "Goè¯­è¨€ä»‹ç»",
				"type":  "æŠ€æœ¯æ–‡æ¡£",
			},
		},
	}

	err = km.LoadDocuments(ctx, docs, knowledge.LoadOptions{
		EnableChunking: false,
		Upsert:         true,
	})
	if err != nil {
		log.Fatal(err)
	}

	// 6. æœç´¢æ–‡æ¡£
	results, err := km.Search(ctx, "ä»€ä¹ˆæ˜¯Goè¯­è¨€", knowledge.SearchOptions{
		Limit:     5,
		Threshold: 0.7,
	})
	if err != nil {
		log.Fatal(err)
	}

	for _, result := range results {
		log.Printf("æ‰¾åˆ°æ–‡æ¡£: %s (ç›¸ä¼¼åº¦: %.2f)", result.Document.Content, result.Score)
	}
}
```

### åˆ›å»ºæ™ºèƒ½ä»£ç†

```go
import (
"github.com/CoolBanHub/aggo/agent"
"github.com/CoolBanHub/aggo/model"
)

func createAgent() (*agent.Agent, error) {
ctx := context.Background()

// åˆ›å»ºèŠå¤©æ¨¡å‹
cm, err := model.NewChatModel()
if err != nil {
return nil, err
}

// åˆ›å»ºå¸¦çŸ¥è¯†åº“çš„ä»£ç†
return agent.NewAgent(ctx, cm,
agent.WithKnowledgeManager(knowledgeManager),
agent.WithKnowledgeQueryConfig(&agent.KnowledgeQueryConfig{
MaxResults:  3,
Threshold:   0.7,
AlwaysQuery: false,
}),
agent.WithSystemPrompt("ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯ä¸“å®¶åŠ©æ‰‹ï¼Œèƒ½å¤Ÿæœç´¢å’Œåˆ†æç›¸å…³æŠ€æœ¯ä¿¡æ¯ã€‚"),
)
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### å‘é‡ç»´åº¦é…ç½®

ç³»ç»Ÿç»Ÿä¸€ä½¿ç”¨**1024ç»´åº¦**å‘é‡ï¼š

```go
// Azure OpenAIåµŒå…¥é…ç½®
dimensions := 1024
config := &embopenai.EmbeddingConfig{
Model:      "text-embedding-3-large",
Dimensions: &dimensions, // é™åˆ¶è¾“å‡ºç»´åº¦ä¸º1024
}

// Milvusé…ç½®
vectorConfig := vectordb.MilvusConfig{
EmbeddingDim: 1024, // åŒ¹é…åµŒå…¥ç»´åº¦
}
```

### æ•°æ®åº“é…ç½®

#### SQLite (å¼€å‘ç¯å¢ƒ)

```go
storage, err := storage.NewSQLiteStorage("knowledge.db")
```

#### MySQL (ç”Ÿäº§ç¯å¢ƒ)

```go
storage, err := storage.NewMySQLStorage("localhost", 3306, "aggo", "user", "password")
```

#### å‘é‡æ•°æ®åº“é…ç½®

**Milvuså‘é‡æ•°æ®åº“:**
```go
vectorDB, err := vectordb.NewMilvusVectorDB(vectordb.MilvusConfig{
	Address:        "127.0.0.1:19530",
	EmbeddingDim:   1024,
	DBName:         "", // ç©ºå­—ç¬¦ä¸²ä½¿ç”¨é»˜è®¤æ•°æ®åº“
	CollectionName: "aggo",
})
```

**PostgreSQLå‘é‡æ•°æ®åº“:**
```go
vectorDB, err := vectordb.NewPostgresVectorDB(vectordb.PostgresConfig{
	Host:         "localhost",
	Port:         5432,
	User:         "user",
	Password:     "password",
	DBName:       "vectordb",
	EmbeddingDim: 1024,
	TableName:    "embeddings",
})
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
aggo/
â”œâ”€â”€ agent/              # AIä»£ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ agent.go           # ä¸»ä»£ç†å®ç°
â”‚   â”œâ”€â”€ knowledge_agent.go # çŸ¥è¯†å‹ä»£ç†
â”‚   â””â”€â”€ option.go          # é…ç½®é€‰é¡¹
â”œâ”€â”€ knowledge/          # çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ manager.go         # çŸ¥è¯†åº“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ interfaces.go      # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ storage/           # å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ vectordb/          # å‘é‡æ•°æ®åº“
â”‚   â”œâ”€â”€ readers/           # æ–‡æ¡£è¯»å–å™¨
â”‚   â””â”€â”€ chunking/          # æ–‡æ¡£åˆ†å—ç­–ç•¥
â”œâ”€â”€ memory/             # è®°å¿†ç³»ç»Ÿ
â”œâ”€â”€ model/              # AIæ¨¡å‹å°è£…
â”‚   â”œâ”€â”€ chat.go            # èŠå¤©æ¨¡å‹
â”‚   â””â”€â”€ embedding.go       # åµŒå…¥æ¨¡å‹
â”œâ”€â”€ tools/              # å·¥å…·é›†
â”‚   â”œâ”€â”€ knowledge_tool.go      # çŸ¥è¯†ç®¡ç†å·¥å…·
â”‚   â”œâ”€â”€ mysql_tool.go          # MySQLæ•°æ®åº“å·¥å…·
â”‚   â”œâ”€â”€ postgres_tool.go       # PostgreSQLæ•°æ®åº“å·¥å…·
â”‚   â””â”€â”€ shell_tool.go          # ç³»ç»Ÿå‘½ä»¤å·¥å…·
â”œâ”€â”€ pkg/                # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ sse/               # Server-Sent Eventsæ”¯æŒ
â”‚   â””â”€â”€ langfuse/          # Langfuseç›‘æ§é›†æˆ
â””â”€â”€ example/            # ç¤ºä¾‹ä»£ç 
```

### æ„å»ºå’Œæµ‹è¯•

```bash
# æ„å»ºæ‰€æœ‰åŒ…
go build ./...

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
go test -v ./knowledge/...
go test -v ./agent/...

# è¿è¡Œç¤ºä¾‹
go run example/knowledge_agent_tool_test/main.go

# è¿è¡ŒSSEç¤ºä¾‹
go run example/sse/main.go
```

## ğŸ› å¸¸è§é—®é¢˜

### å‘é‡ç»´åº¦ä¸åŒ¹é…é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `the num_rows (N) of field (vector) is not equal to passed num_rows (M)`

**è§£å†³æ–¹æ¡ˆ**:

1. ç¡®ä¿Azure OpenAIé…ç½®ä¸­è®¾ç½®äº†æ­£ç¡®çš„ç»´åº¦é™åˆ¶
2. æ£€æŸ¥Milvusçš„`EmbeddingDim`é…ç½®æ˜¯å¦ä¸å®é™…åµŒå…¥ç»´åº¦åŒ¹é…
3. ä¸´æ—¶ç¦ç”¨æ–‡æ¡£åˆ†å—åŠŸèƒ½è¿›è¡Œè°ƒè¯•: `EnableChunking: false`

### Milvusè¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `database not found[database=xxx]`

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¿æ¥é»˜è®¤æ•°æ®åº“: `DBName: ""`

### GORMæ—¥å¿—é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `nil pointer dereference`

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨`logger.Default.LogMode()`è€Œä¸æ˜¯`config.Logger.LogMode()`

### PostgreSQLå‘é‡æ•°æ®åº“è¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `relation "public.embeddings" does not exist`

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿PostgreSQLå·²å®‰è£…å¹¶å¯ç”¨pgvectoræ‰©å±•ï¼š
```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚ã€‚å¦‚æœæ‚¨æƒ³ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œè¯·å…ˆå¼€issueè®¨è®ºæ‚¨æƒ³è¦å®ç°çš„æ›´æ”¹ã€‚

---

**AGGO** - è®©AIæ›´æ™ºèƒ½ï¼Œè®©å¼€å‘æ›´ç®€å• ğŸš€